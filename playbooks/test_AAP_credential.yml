---
- name: Test AAP credential
  hosts: fmc
  connection: local
  gather_facts: false

  vars:
#    fmc_username: "{{ credential['username'] }}"
#    fmc_password: "{{ credential['password'] }}"

  tasks:
#    - name: Show injected credential variables
#      debug:
#        msg: "username={{ fmc_username | default('NOT SET') }}, password={{ fmc_password | default('NOT SET') }}"

    - name: Retrieve credential
      ansible.builtin.set_fact:
        my_password: "{{ lookup('credential', 'fmc', 'password') }}"

    - name: Use retrieved password
      ansible.builtin.command:
        command: "echo {{ my_password }}"
